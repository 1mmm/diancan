<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link href="https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">
    <title>贷款申请管理系统</title>
</head>
<body>

    <nav class="navbar navbar-default">
        <div class="container-fluid">
            <div class="navbar-header">
                <a class="navbar-brand" href="/">贷款申请管理系统</a>
            </div>
        </div>
    </nav>

    <div class="container">
        <ul class="list-group" id="list"></ul>
    </div>

    <div class="modal fade" id="info" tabindex="-1" role="dialog" aria-labelledby="linfo">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                    <h4 class="modal-title" id="linfo">用户信息</h4>
                </div>
                <div class="modal-body">
                    <form class="form-horizontal">
                        <div class="form-group">
                            <label class="col-sm-2 control-label">姓名</label>
                            <div class="col-sm-10">
                                <p class="form-control-static" id="name"></p>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-2 control-label">学校</label>
                            <div class="col-sm-10">
                                <p class="form-control-static" id="school"></p>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-2 control-label">学号</label>
                            <div class="col-sm-10">
                                <p class="form-control-static" id="stuid"></p>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-2 control-label">性别</label>
                            <div class="col-sm-10">
                                <p class="form-control-static" id="sex"></p>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-2 control-label">专业</label>
                            <div class="col-sm-10">
                                <p class="form-control-static" id="major"></p>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-2 control-label">年级</label>
                            <div class="col-sm-10">
                                <p class="form-control-static" id="grade"></p>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-2 control-label">GPA</label>
                            <div class="col-sm-10">
                                <p class="form-control-static" id="gpa"></p>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-2 control-label">英语成绩</label>
                            <div class="col-sm-10">
                                <p class="form-control-static" id="english"></p>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-2 control-label">实习时间</label>
                            <div class="col-sm-10">
                                <p class="form-control-static" id="worktime"></p>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-2 control-label">有无工作经验</label>
                            <div class="col-sm-10">
                                <p class="form-control-static" id="experiment"></p>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-2 control-label">家庭住址</label>
                            <div class="col-sm-10">
                                <p class="form-control-static" id="addr"></p>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-2 control-label">电话</label>
                            <div class="col-sm-10">
                                <p class="form-control-static" id="phone"></p>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-2 control-label">邮箱</label>
                            <div class="col-sm-10">
                                <p class="form-control-static" id="mail"></p>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-2 control-label">获奖等级</label>
                            <div class="col-sm-10">
                                <p class="form-control-static" id="rank"></p>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-2 control-label">收入</label>
                            <div class="col-sm-10">
                                <p class="form-control-static" id="income"></p>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-2 control-label">抵押</label>
                            <div class="col-sm-10">
                                <p class="form-control-static" id="pledge"></p>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-2 control-label">贷款银行</label>
                            <div class="col-sm-10">
                                <p class="form-control-static" id="bank"></p>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-2 control-label">储蓄</label>
                            <div class="col-sm-10">
                                <p class="form-control-static" id="saving"></p>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-2 control-label">贷款理由</label>
                            <div class="col-sm-10">
                                <p class="form-control-static" id="reason"></p>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-2 control-label">银行卡号</label>
                            <div class="col-sm-10">
                                <p class="form-control-static" id="bankno"></p>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-2 control-label">身份证号</label>
                            <div class="col-sm-10">
                                <p class="form-control-static" id="idno"></p>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-2 control-label">父母姓名</label>
                            <div class="col-sm-10">
                                <p class="form-control-static" id="pname"></p>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-2 control-label">父亲身份证号</label>
                            <div class="col-sm-10">
                                <p class="form-control-static" id="fidno"></p>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-2 control-label">母亲身份证号</label>
                            <div class="col-sm-10">
                                <p class="form-control-static" id="midno"></p>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-2 control-label">系统计算出的最大申请额度</label>
                            <div class="col-sm-10">
                                <p class="form-control-static" id="pre"></p>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-2 control-label">照片</label>
                            <div class="col-sm-10">
                                <p class="form-control-static" id="photo"></p>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://cdn.bootcss.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script>
        function wrap_item(e) {
            return '<li class="list-group-item">' +
                '<div style="display:inline-block">' +
                    '<span>#' + e.id + '</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;' +
                    '<span>用户名：' + e.uid + '</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;' +
                    '<span>期望贷款金额：' + e.want + '</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;' +
                    '<span>父母还款额：' + e.ppay + '</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;' +
                    '<span>本人每月还款：' + e.selfmpay + '</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;' +
                    '<span>父母每月还款：' + e.pmpay + '</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;' +
                    '<span>利息' + e.interest + '</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;' +
                    '<span>手续费：' + e.poundage + '</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;' +
                '</div><hr>' +
                '<div class="btn-group" role="group" aria-label="...">' +
                    '<button type="button" class="btn btn-info" onclick="info(this)" data-uid="' + e.uid + '">查看资料</button>' +
                    '<button type="button" class="btn btn-success" onclick="deal(this,1)" data-id="' + e.id + '">批准</button>' +
                    '<button type="button" class="btn btn-danger" onclick="deal(this,2)" data-id="' + e.id + '">拒绝</button>' +
                '</div>' +
            '</li>';
        }
        function refresh() {
            $.ajax({
                url: "admin/applist.php",
                method: "get",
                dataType: "json",
                success: function(d) {
                    if (d.errno) {
                        alert("请求错误，请刷新重试");
                    } else {
                        if (d.data.length == 0) {
                            $("#list").html('没有需要审核的贷款申请');
                        } else {
                            $("#list").html('');
                            $.each(d.data, function(k, v) {
                                $("#list").append(wrap_item(v));
                            });
                        }
                    }
                }
            });
        }
        function gen_img(b64) {
            return '<img style="width:100%;height:auto;" src="data:image/jpeg;base64,' + b64 + '">';
        }
        function show_data(d) {
            var keys = [
                'name', 'school', 'stuid', 'sex',
                'grade', 'gpa', 'reason', 'english',
                'worktime', 'experiment', 'addr', 'phone',
                'mail', 'rank', 'income', 'pledge',
                'bank', 'saving', 'bankno', 'idno',
                'pname', 'fidno', 'midno', 'pre'
            ];
            var srank = [ "北京大学", "清华大学", "武汉大学", "复旦大学", "浙江大学", "上海交通大学", "南京大学", "中国人民大学", "吉林大学", "华中科技大学", "四川大学", "中山大学", "南开大学", "天津大学", "中国科学技术大学", "西安交通大学", "中南大学", "哈尔滨工业大学", "北京师范大学", "山东大学", "厦门大学", "东南大学", "北京航空航天大学", "同济大学", "东北大学", "大连理工大学", "华南理工大学", "华东师范大学", "电子科技大学", "湖南大学", "重庆大学", "西北工业大学", "中国农业大学", "兰州大学", "北京理工大学", "华中师范大学", "西南大学", "东北师范大学", "南京农业大学", "北京交通大学", "西南交通大学", "长安大学", "武汉理工大学", "河海大学", "华中农业大学", "南京师范大学", "郑州大学", "南京理工大学", "西安电子科技大学", "中国海洋大学", "华东理工大学", "苏州大学", "南京航空航天大学", "西北大学", "中国矿业大学", "北京科技大学", "北京协和医学院", "上海大学", "南昌大学", "西北农林科技大学", "湖南师范大学", "云南大学", "哈尔滨工程大学", "华南师范大学", "东华大学", "上海财经大学", "陕西师范大学", "中国政法大学", "暨南大学", "北京邮电大学", "江南大学", "合肥工业大学", "北京化工大学", "中南财经政法大学", "福建师范大学", "中国地质大学（武汉）", "深圳大学", "福州大学", "山西大学", "西南财经大学", "广西大学", "首都师范大学", "华南农业大学", "北京工业大学", "北京林业大学", "河南大学", "昆明理工大学", "燕山大学", "浙江工业大学", "中央民族大学", "中国石油大学（华东）", "对外经济贸易大学", "浙江师范大学", "首都医科大学", "安徽大学", "上海理工大学", "南京工业大学", "天津师范大学", "杭州电子科技大学", "河北大学" ];
            var bname = ["", "花旗银行", "中国银行", "农业银行", "工商银行", "建设银行"];
            var prank = ["", "国际级", "国家级", "省级", "市级", "无"];
            var mstr = ["", "艺术", "文史", "理工", "金融", "社科", "其他"]

            for (var idx in keys) {
                var key = keys[idx];
                $("#" + key).text(d[key]);
            }

            $("#school").text(srank[parseInt(d.school)]);
            $("#bank").text(bname[parseInt(d.bank)]);
            $("#rank").text(prank[parseInt(d.rank)]);
            $("#major").text(mstr[parseInt(d.major)]);
            $("#sex").text(parseInt(d.sex) ? "男" : "女");
            $("#experiment").text(d.experiment ? "有" : "无");

            $("#photo").text("");
            if (typeof d.photo == 'string') {
                var imgs = d.photo.split(',');
                for (idx in imgs) {
                    var img = imgs[idx];
                    $("#photo").append(gen_img(img));
                }
            }

            $("#info").modal();
        }
        function info(e) {
            $.ajax({
                url: "admin/info.php",
                method: "get",
                dataType: "json",
                data: { uid: $(e).data("uid") },
                success: function(d) {
                    if (d.errno) {
                        alert("请求错误，请重试");
                    } else {
                        show_data(d.data);
                    }
                }
            });
        }
        function deal(e, s) {
            var i = $(e).data('id');
            $.ajax({
                url: "admin/update.php",
                dataType: "json",
                data: { id: i, op: s},
                success: function(d) {
                    if (d.errno) {
                        alert("操作失败请重试");
                    } else {
                        alert("操作成功");
                    }
                    refresh();
                }
            });
        }
        $(function() {
            refresh();
        });
    </script>
</body>
</html>